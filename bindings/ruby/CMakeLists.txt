message(STATUS "Configuring ${RUBY_TARGET} target")

# Save original swig output dir
set(CMAKE_SWIG_OUTDIR ${CMAKE_SWIG_ROOT_OUTDIR}/ruby)
set(SWIG_LANGUAGE_DIR ${CMAKE_SWIG_ROOT_OUTDIR}/ruby)

set(RUBY_SWIG_INTERFACES ${CMAKE_CURRENT_LIST_DIR}/showtime_ruby.i)
set_source_files_properties(${RUBY_SWIG_INTERFACES} PROPERTIES 
	CPLUSPLUS ON
)

# foreach(SWIG_INTERFACE_FILE ${RUBY_SWIG_INTERFACES})
# 	get_filename_component(OUTFILE_NAME ${SWIG_INTERFACE_FILE} NAME_WE)
#     set(SWIG_ARGS
#         "-c++"
#         "-ruby"
#         "-I${Showtime_INCLUDE_DIRS}"
#         "-outdir" "${SWIG_LANGUAGE_DIR}"
#         "-o" "${CMAKE_SWIG_OUTDIR}/${OUTFILE_NAME}RUBY_wrap.cxx"
#     )
#     list(APPEND SWIG_ARGS "${SWIG_INTERFACE_FILE}")
#     file(MAKE_DIRECTORY ${SWIG_LANGUAGE_DIR})
#     execute_process(COMMAND ${SWIG_EXECUTABLE} ${SWIG_ARGS} RESULT_VARIABLE SWIG_OUTPUT)
# endforeach()

swig_add_library(${RUBY_TARGET} 
	LANGUAGE ruby 
	TYPE SHARED 
    OUTPUT_DIR ${SWIG_LANGUAGE_DIR}
    OUTFILE_DIR ${CMAKE_SWIG_OUTDIR}
    SOURCES ${RUBY_SWIG_INTERFACES}
)

set_target_properties(${RUBY_TARGET} PROPERTIES 
	SWIG_USE_TARGET_INCLUDE_DIRECTORIES TRUE
	LIBRARY_OUTPUT_DIRECTORY ${CMAKE_LIBRARY_OUTPUT_DIRECTORY}
    SWIG_SUPPORT_FILES_DIRECTORY ${SWIG_LANGUAGE_DIR}
	OUTPUT_NAME "showtime"
)

swig_link_libraries(${RUBY_TARGET} PUBLIC 
	${CLIENT_TARGET_STATIC} 
	${SERVER_TARGET_STATIC}
	${RUBY_LIBRARY}
)

target_include_directories(${RUBY_TARGET} PUBLIC 
	${RUBY_INCLUDE_DIRS}
)

add_dependencies(${SWIG_MODULE_${RUBY_TARGET}_REAL_NAME} 
	${CLIENT_TARGET}
	${SERVER_TARGET}
)
